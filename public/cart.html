<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Orders</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <h1>Customer Orders</h1>
    <% orders.forEach(customer => { %>
        <h2><%= customer.first_name %> <%= customer.last_name %> </h2>
            <p> mobile no :<%= customer.phone %>
                <address> <%= customer.address %> <%= customer.state %> <%= customer.city %> <%= customer.zip %> </address> notes: <%= customer.notes %></p>
        <table>
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Product ID</th>
                    <th>Product Name</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Order Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <% customer.orders.forEach(order => { %>
                    <tr>
                        <td><%= order.order_id %></td>
                        <td><%= order.product_id %></td>
                        <td><%= order.product_name %></td>
                        <td><%= order.quantity %></td>
                        <td><%= order.total %></td>
                        <td><%= order.order_date %></td>
                        <td><%= order.Status %></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    <% }); %>




     <% customer.orders.forEach(order => { %>
        <table>
            <tr><th>Order Details</th></tr>
            <tr><td>Order ID</td><td><%= order.order_id %></td></tr>
            <tr><td>Product Name: </td><td><%= order.product_name %></td></tr>
            <tr><td>Product ID: </td><td><%= order.product_id %></td></tr>
            <tr><td>Price: </td><td>₹ <%= order.product_price %></td></tr>
            <tr><td>Quantity: </td><td><%= order.quantity %></td></tr>
            <tr>
                <td>Order Date</td>
                <td><%= order.order_date %></td>
            </tr>
            <tr><td>Total Amount: </td><td>₹<%= order.total %></td></tr>

        </table>
        <% }); %>
</body>
</html>
<style> body { font-family: Arial, sans-serif; padding: 0; margin: 0; box-sizing: border-box; } .container { padding: 20px; } h1, h2 { text-align: center; } table { width: 100%; border-collapse: collapse; margin-bottom: 20px; } th, td { border: 1px solid #ddd; padding: 8px; text-align: left; } th { background-color: #f2f2f2; font-weight: bold; } tr:nth-child(even) { background-color: #f9f9f9; } tr:hover { background-color: #f1f1f1; } .responsive-table { display: block; overflow-x: auto; white-space: nowrap; } .form-container { display: flex; flex-direction: column; align-items: center; } form { width: 100%; max-width: 500px; margin: 20px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); } label, select, button { width: 100%; margin: 10px 0; } @media (max-width: 600px) { th, td { padding: 12px; } form { padding: 15px; }  } </style>
=========
cart code
=====
app.post("/cart/update/:id", (req, res) => {
    
    const { id } = req.params;
    const { quantity } = req.body;

    const item = cart.find(item => item.id === id);
    if (item) {
        item.quantity = parseInt(quantity);
    }

    res.redirect("/cart");
});

// Remove item from the cart
app.post("/cart/remove/:id", (req, res) => {
    const { id } = req.params;

    cart = cart.filter(item => item.id !== id);

    res.redirect("/cart");
});

// Cart Routes 
app.post("/cart/add", (req, res) => { 
     
    const { quantity ,id, name ,image,price} = req.body; 
    // Check if the item is already in the cart 
    const existingItem = cart.find(item => item.id === id); 
    if (existingItem) { 
        // Update the quantity if it already exists
         existingItem.quantity += parseInt(quantity); 
        } else { 
            // Add new item to the cart
             cart.push({ id, name,image,price, quantity: parseInt(quantity) }); 
            } res.redirect("/cart"); });
 app.get("/cart", (req, res) => { 
    res.render("cart.ejs", { cart }); });
============
new checkout 
========
app.get("/checkout", async (req, res) => {
    const user = req.user;
    if (req.isAuthenticated()) {
        const type = "view";
        const orderid = 9;
        let total;
        const cart = req.session.cart || [];

        const cartItems = cart.map(item => [
            item.id,
            item.name,
            item.quantity,
            item.price,
            total = item.quantity * item.price,
            type,
            user.id,
            orderid
        ]);

        try {
            if (cartItems.length > 0) {
                const queryText = "INSERT INTO cart (product_id, product_name, quantity, price, total, cart_type, customer_id, order_id) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)";
                for (const orderItem of cartItems) {
                    await db.query(queryText, orderItem);
                }
            }
        } catch (error) {
            console.log("Error inserting into cart:", error);
        }

        res.render("checkout.ejs", {
            cart,
            first_name: user.first_name,
            last_name: user.last_name,
            email: user.email,
            phone: user.phone,
            address: user.address,
            state: user.state,
            zip: user.zip,
            city: user.city,
            user_id: user.id
        });
    } else {
        res.redirect('/login');
    }
});
================
checkout old
===
app.get("/checkout",async(req,res)=>{
    
    const user = req.user;
    if(req.isAuthenticated()){
        
            const type="view";
            const orderid=9;
            let total;
            const cart = req.session.cart;
    console.log("cart",cart);
             const cartiteam= cart.map(item =>[
                
                item.id,
                item.name,
                item.quantity,
                item.price,
                total=item.quantity*item.price,
                type,
                user.id,
                orderid
             ]);
            //  console.log("cart page",cartiteam);
            try {
                if (cartiteam.length > 0) {
                    const queryText = "INSERT INTO cart (product_id, product_name, quantity, price, total, cart_type, customer_id, order_id) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)";
                    for (const orderItem of cartiteam) {
                        await db.query(queryText, orderItem);
                    }
                }
            } catch (error) {
                console.log("Error inserting into cart:", error);
            }
             
             
             //req.session.cart = [];
        res.render("checkout.ejs",({cart,first_name:user.first_name,last_name:user.last_name,email:user.email,phone:user.phone,address:user.address,state:user.state,zip:user.zip,city:user.city,user_id:user.id}));

    }
    else{
        res.redirect('/login');
    }
    

    
})